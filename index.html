<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—É—Ç—å –ì–µ—Ä–æ—è - –≠–ø–∏—á–µ—Å–∫–∞—è –ò–≥—Ä–∞ –í—ã–±–æ—Ä–æ–≤</title>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <script src="additional-scenes.js"></script>
    <script src="game-systems.js"></script>
    <script src="vk-integration.js"></script>
    <script src="lobby-system.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
            position: relative;
        }

        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        body.loaded .loading-overlay {
            opacity: 0;
            visibility: hidden;
        }

        .loading-content {
            text-align: center;
            color: #00ff88;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-top: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* –§–æ–Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .main-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .game-header {
            padding: 15px;
            background: linear-gradient(90deg, rgba(0,255,136,0.1), rgba(0,122,255,0.1));
            border-bottom: 2px solid rgba(0,255,136,0.3);
            position: relative;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00ff88, #00aaff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            position: relative;
        }

        .level-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b35;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid #fff;
        }

        .player-stats {
            display: flex;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        /* XP Bar */
        .xp-container {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 20px;
            position: relative;
            overflow: hidden;
        }

        .xp-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00aaff);
            border-radius: 10px;
            transition: width 1s ease;
            position: relative;
        }

        .xp-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: xp-shimmer 2s infinite;
        }

        @keyframes xp-shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 0 4px rgba(0,0,0,0.8);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .game-nav {
            display: flex;
            gap: 8px;
            padding: 12px;
            background: rgba(0,0,0,0.3);
        }

        .nav-btn {
            flex: 1;
            padding: 10px 8px;
            background: linear-gradient(45deg, rgba(0,255,136,0.1), rgba(0,122,255,0.1));
            border: 2px solid rgba(0,255,136,0.3);
            border-radius: 12px;
            color: #fff;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover {
            background: linear-gradient(45deg, rgba(0,255,136,0.3), rgba(0,122,255,0.3));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,255,136,0.2);
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        /* –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã */
        .game-content {
            flex: 1;
            padding: 15px;
            display: none;
        }

        .game-content.active {
            display: block;
        }

        /* –ë–æ—Å—Å –∞—Ä–µ–Ω–∞ */
        .boss-arena {
            background: linear-gradient(135deg, #660000, #330000);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            border: 3px solid #ff6b35;
        }

        .boss-arena::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255,107,53,0.1), transparent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .boss-title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            color: #ff6b35;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255,107,53,0.5);
        }

        /* –°—Ü–µ–Ω–∞ –∏–≥—Ä—ã */
        .scene-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
        }

        .scene-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
            text-align: center;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-btn {
            background: linear-gradient(45deg, rgba(0,255,136,0.1), rgba(0,122,255,0.1));
            border: 2px solid rgba(0,255,136,0.3);
            border-radius: 15px;
            padding: 20px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover {
            background: linear-gradient(45deg, rgba(0,255,136,0.3), rgba(0,122,255,0.3));
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(0,255,136,0.3);
        }

        /* –õ–∏–¥–µ—Ä–±–æ—Ä–¥ */
        .leaderboard {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }

        .leaderboard-header {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            color: #00ff88;
        }

        .leader-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border-left: 4px solid #00ff88;
        }

        .leader-rank {
            font-size: 20px;
            font-weight: bold;
            color: #ff6b35;
            margin-right: 15px;
        }

        .leader-info {
            flex: 1;
        }

        .leader-name {
            font-weight: bold;
            font-size: 16px;
        }

        .leader-level {
            font-size: 14px;
            opacity: 0.8;
        }

        .leader-score {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
        }

        /* –ì–∏–ª—å–¥–∏–∏ */
        .guild-card {
            background: linear-gradient(135deg, rgba(0,122,255,0.1), rgba(0,255,136,0.1));
            border-radius: 20px;
            padding: 25px;
            margin: 15px 0;
            border: 2px solid rgba(0,122,255,0.3);
        }

        .guild-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .guild-name {
            font-size: 20px;
            font-weight: bold;
            color: #00aaff;
        }

        .guild-members {
            font-size: 14px;
            opacity: 0.8;
        }

        .guild-join-btn {
            background: linear-gradient(45deg, #00aaff, #00ff88);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .guild-join-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,170,255,0.4);
        }

        /* –¢—É—Ä–Ω–∏—Ä—ã */
        .tournament-card {
            background: linear-gradient(135deg, rgba(255,107,53,0.1), rgba(255,193,7,0.1));
            border-radius: 20px;
            padding: 25px;
            margin: 15px 0;
            border: 2px solid rgba(255,107,53,0.3);
            position: relative;
        }

        .tournament-status {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff6b35;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .tournament-title {
            font-size: 20px;
            font-weight: bold;
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .tournament-prize {
            font-size: 24px;
            font-weight: bold;
            color: #ffc107;
            text-align: center;
            margin: 15px 0;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .floating-text {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            animation: float-up 2s ease-out forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) scale(1.2);
            }
        }

        .particle-effect {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00ff88;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-burst 1s ease-out forwards;
        }

        @keyframes particle-burst {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0) translateY(-100px);
            }
        }

        /* –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è */
        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ffc107, #ff6b35);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255,193,7,0.4);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1000;
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-icon {
            font-size: 30px;
            text-align: center;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-weight: bold;
            font-size: 16px;
            text-align: center;
        }

        /* –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã */
        .daily-quest {
            background: linear-gradient(135deg, rgba(156,39,176,0.1), rgba(103,58,183,0.1));
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            border-left: 4px solid #9c27b0;
        }

        .quest-title {
            font-weight: bold;
            color: #9c27b0;
            margin-bottom: 10px;
        }

        .quest-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quest-bar {
            flex: 1;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            margin-right: 15px;
            overflow: hidden;
        }

        .quest-fill {
            height: 100%;
            background: linear-gradient(90deg, #9c27b0, #673ab7);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .quest-reward {
            font-weight: bold;
            color: #ffc107;
        }

        /* PvP –î—É—ç–ª–∏ */
        .pvp-arena {
            background: linear-gradient(135deg, #8B0000, #4B0082);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 3px solid #FF4500;
            position: relative;
            overflow: hidden;
        }

        .pvp-arena::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255,69,0,0.1), transparent);
            animation: pvp-pulse 1.5s infinite;
        }

        @keyframes pvp-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .duel-participants {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .duel-player {
            text-align: center;
            flex: 1;
        }

        .duel-player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF4500, #FF6347);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin: 0 auto 10px;
            border: 3px solid #FFD700;
        }

        .duel-vs {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            margin: 0 20px;
        }

        .duel-score {
            font-size: 18px;
            font-weight: bold;
            color: #FF4500;
        }

        .battle-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            animation: battle-spin 2s infinite;
        }

        @keyframes battle-spin {
            0% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
            50% { transform: translate(-50%, -50%) rotate(180deg) scale(1.2); }
            100% { transform: translate(-50%, -50%) rotate(360deg) scale(1); }
        }

        /* –¢—É—Ä–Ω–∏—Ä–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .tournament-bracket {
            background: linear-gradient(135deg, rgba(255,193,7,0.1), rgba(255,107,53,0.1));
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            border-left: 4px solid #FFC107;
        }

        .tournament-match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin: 5px 0;
        }

        .match-player {
            flex: 1;
            text-align: center;
        }

        .match-score {
            font-weight: bold;
            color: #FFC107;
            margin: 0 15px;
        }

        /* –ì–∏–ª—å–¥–µ–π—Å–∫–∏–µ —Å—Ç–∏–ª–∏ */
        .guild-member {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin: 5px 0;
        }

        .member-rank {
            background: linear-gradient(45deg, #FFC107, #FF6B35);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }

        /* –õ–∏–º–∏—Ç—ã */
        .daily-limits {
            background: linear-gradient(135deg, rgba(156,39,176,0.1), rgba(103,58,183,0.1));
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #9C27B0;
        }

        .limit-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .limit-fill {
            height: 100%;
            background: linear-gradient(90deg, #9C27B0, #673AB7);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π */
        .friends-section {
            background: linear-gradient(135deg, rgba(0,122,255,0.1), rgba(0,255,136,0.1));
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #00A2FF;
        }

        .friends-header {
            font-size: 18px;
            font-weight: bold;
            color: #00A2FF;
            margin-bottom: 15px;
            text-align: center;
        }

        .friend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin: 8px 0;
            border: 1px solid rgba(0,162,255,0.2);
        }

        .friend-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00A2FF, #00FF88);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }

        .friend-name {
            font-weight: bold;
            color: #fff;
        }

        .friend-status {
            font-size: 12px;
            opacity: 0.8;
        }

        .friend-actions {
            display: flex;
            gap: 8px;
        }

        .friend-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .challenge-btn {
            background: linear-gradient(45deg, #FF4500, #FF6347);
            color: white;
        }

        .challenge-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(255,69,0,0.3);
        }

        .invite-btn {
            background: linear-gradient(45deg, #00A2FF, #00FF88);
            color: white;
        }

        .invite-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,162,255,0.3);
        }

        .app-user {
            border-color: #00FF88;
            background: rgba(0,255,136,0.1);
        }

        .non-app-user {
            border-color: #FFA500;
            background: rgba(255,165,0,0.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–æ–±–±–∏ */
        .lobby-section {
            background: linear-gradient(135deg, rgba(255,107,53,0.1), rgba(255,193,7,0.1));
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #FF6B35;
        }

        .lobby-header {
            font-size: 18px;
            font-weight: bold;
            color: #FF6B35;
            margin-bottom: 15px;
            text-align: center;
        }

        .public-challenge {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255,107,53,0.3);
        }

        .challenge-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .challenger-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .challenger-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF6B35, #FFC107);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
        }

        .challenge-details {
            text-align: right;
        }

        .challenge-bet {
            font-size: 16px;
            font-weight: bold;
            color: #FFC107;
        }

        .challenge-level {
            font-size: 12px;
            opacity: 0.8;
        }

        .challenge-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .rating-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .rating-tab {
            flex: 1;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rating-tab.active {
            background: linear-gradient(45deg, #FF6B35, #FFC107);
        }

        .rating-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin: 5px 0;
        }

        .rating-rank {
            font-size: 18px;
            font-weight: bold;
            color: #FFC107;
            margin-right: 10px;
        }

        .rating-player {
            flex: 1;
        }

        .rating-stats {
            text-align: right;
            font-size: 12px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .game-header {
                padding: 15px;
            }
            
            .player-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .player-stats {
                justify-content: center;
                gap: 20px;
            }
            
            .game-nav {
                flex-direction: column;
                gap: 8px;
                padding: 15px;
            }
            
            .nav-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .scene-text {
                font-size: 16px;
                line-height: 1.5;
            }
            
            .option-btn {
                padding: 15px;
                font-size: 14px;
            }
            
            .duel-participants {
                flex-direction: column;
                gap: 20px;
            }
            
            .duel-vs {
                margin: 10px 0;
            }
            
            .friend-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .friend-actions {
                justify-content: center;
            }
            
            .guild-card, .tournament-card {
                padding: 20px;
            }
            
            .boss-arena, .scene-container {
                padding: 20px;
                margin: 15px 0;
            }
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 480px) {
            .game-header {
                padding: 10px;
            }
            
            .player-avatar {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .level-badge {
                width: 20px;
                height: 20px;
                font-size: 10px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            .stat-label {
                font-size: 11px;
            }
            
            .game-nav {
                padding: 10px;
            }
            
            .nav-btn {
                padding: 10px;
                font-size: 13px;
            }
            
            .scene-text {
                font-size: 15px;
            }
            
            .option-btn {
                padding: 12px;
                font-size: 13px;
            }
            
            .boss-title, .leaderboard-header {
                font-size: 20px;
            }
            
            .guild-name, .tournament-title {
                font-size: 18px;
            }
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ */
        body {
            overflow-y: auto;
            min-height: 100vh;
        }

        .main-screen {
            min-height: 100vh;
            overflow-y: auto;
        }

        .game-content {
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ü—É—Ç—å –ì–µ—Ä–æ—è...</h2>
            <p>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —ç–ø–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</p>
        </div>
    </div>

    <!-- –§–æ–Ω–æ–≤—ã–µ –∑–≤–µ–∑–¥—ã -->
    <div class="stars" id="stars"></div>

    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="main-screen" id="main-screen">
        <!-- –®–∞–ø–∫–∞ –∏–≥—Ä—ã -->
        <div class="game-header">
            <div class="player-info">
                <div class="player-avatar" id="player-avatar">
                    üë§
                    <div class="level-badge" id="player-level">1</div>
                </div>
                <div class="player-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="player-power">0</div>
                        <div class="stat-label">–°–∏–ª–∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="player-wisdom">0</div>
                        <div class="stat-label">–ú—É–¥—Ä–æ—Å—Ç—å</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="player-honor">0</div>
                        <div class="stat-label">–ß–µ—Å—Ç—å</div>
                    </div>
                </div>
            </div>
            <div class="xp-container">
                <div class="xp-bar" id="xp-bar" style="width: 0%">
                    <div class="xp-text" id="xp-text">0 / 100 XP</div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="game-nav">
            <button class="nav-btn" onclick="showSection('adventure')">
                üó°Ô∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
            </button>
            <button class="nav-btn" onclick="showSection('pvp')">
                ‚öîÔ∏è PvP –î—É—ç–ª–∏
            </button>
            <button class="nav-btn" onclick="showSection('leaderboard')">
                üèÜ –†–µ–π—Ç–∏–Ω–≥
            </button>
            <button class="nav-btn" onclick="showSection('guilds')">
                ‚öîÔ∏è –ì–∏–ª—å–¥–∏–∏
            </button>
            <button class="nav-btn" onclick="showSection('tournaments')">
                üëë –¢—É—Ä–Ω–∏—Ä—ã
            </button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π -->
        <div class="game-content active" id="adventure-content">
            <div class="daily-quest">
                <div class="quest-title">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–≤–µ—Å—Ç: –ú—É–¥—Ä—ã–µ —Ä–µ—à–µ–Ω–∏—è</div>
                <div class="quest-progress">
                    <div class="quest-bar">
                        <div class="quest-fill" id="daily-progress" style="width: 0%"></div>
                    </div>
                    <div class="quest-reward">+200 XP</div>
                </div>
                <p>–ü—Ä–∏–º–∏—Ç–µ 5 –º—É–¥—Ä—ã—Ö —Ä–µ—à–µ–Ω–∏–π (0/5)</p>
            </div>

            <div class="boss-arena" id="boss-arena" style="display: none;">
                <div class="boss-title">‚ö° –ë–û–°–°: –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ö—Ä–∏–∑–∏—Å</div>
                <p style="text-align: center; margin-bottom: 20px;">
                    –í—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å —Å–µ—Ä—å–µ–∑–Ω—ã–º –∏—Å–ø—ã—Ç–∞–Ω–∏–µ–º! –í–∞—à –≤—ã–±–æ—Ä –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –∏—Å—Ö–æ–¥ –±–∏—Ç–≤—ã!
                </p>
            </div>

            <div class="scene-container" id="scene-container">
                <div class="scene-text" id="scene-text">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ "–ü—É—Ç—å –ì–µ—Ä–æ—è"! –ó–¥–µ—Å—å –∫–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –≤–∞—à—É —Å—É–¥—å–±—É. 
                    –ü—Ä–æ–∫–∞—á–∏–≤–∞–π—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, —Å—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –±–æ—Å—Å–∞–º–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π, 
                    —Å–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å —Å –¥—Ä—É–∑—å—è–º–∏ –∏ —Å—Ç–∞–Ω—å—Ç–µ –ª–µ–≥–µ–Ω–¥–æ–π!
                </div>
                <div class="options-container" id="options-container">
                    <button class="option-btn" onclick="startFirstAdventure()">
                        üöÄ –ù–∞—á–∞—Ç—å –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ
                    </button>
                    <button class="option-btn" onclick="showTutorial()">
                        üìö –û–±—É—á–µ–Ω–∏–µ –∏–≥—Ä–µ
                    </button>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
        <div class="game-content" id="leaderboard-content">
            <div class="leaderboard">
                <div class="leaderboard-header">üèÜ –¢–æ–ø –ì–µ—Ä–æ–µ–≤</div>
                <div class="leader-item">
                    <div class="leader-rank">1</div>
                    <div class="leader-info">
                        <div class="leader-name">–ú—É–¥—Ä—ã–π –í–æ–∏–Ω</div>
                        <div class="leader-level">–£—Ä–æ–≤–µ–Ω—å 25</div>
                    </div>
                    <div class="leader-score">15,420</div>
                </div>
                <div class="leader-item">
                    <div class="leader-rank">2</div>
                    <div class="leader-info">
                        <div class="leader-name">–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –°—É–¥—å—è</div>
                        <div class="leader-level">–£—Ä–æ–≤–µ–Ω—å 23</div>
                    </div>
                    <div class="leader-score">14,150</div>
                </div>
                <div class="leader-item">
                    <div class="leader-rank">3</div>
                    <div class="leader-info">
                        <div class="leader-name">–•—Ä–∞–±—Ä—ã–π –ó–∞—â–∏—Ç–Ω–∏–∫</div>
                        <div class="leader-level">–£—Ä–æ–≤–µ–Ω—å 21</div>
                    </div>
                    <div class="leader-score">12,890</div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≥–∏–ª—å–¥–∏–π -->
        <div class="game-content" id="guilds-content">
            <div class="guild-card" id="current-guild-info" style="display: none;">
                <div class="guild-header">
                    <div>
                        <div class="guild-name" id="current-guild-name">–ú–æ—è –≥–∏–ª—å–¥–∏—è</div>
                        <div class="guild-members" id="current-guild-members">–£—á–∞—Å—Ç–Ω–∏–∫–∏</div>
                    </div>
                    <button class="guild-join-btn" onclick="leaveCurrentGuild()">–ü–æ–∫–∏–Ω—É—Ç—å</button>
                </div>
                <p id="current-guild-description">–û–ø–∏—Å–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏</p>
                <div class="guild-member" style="margin-top: 15px;">
                    <span>–í–∞—à –≤–∫–ª–∞–¥:</span>
                    <span id="player-contribution">0</span>
                </div>
                <button class="guild-join-btn" style="width: 100%; margin-top: 10px;" onclick="contributeToGuild()">
                    –í–Ω–µ—Å—Ç–∏ 100 XP –≤ –∫–∞–∑–Ω—É
                </button>
            </div>

            <div class="guild-card">
                <div class="guild-header">
                    <div>
                        <div class="guild-name">‚öîÔ∏è –†—ã—Ü–∞—Ä–∏ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏</div>
                        <div class="guild-members">42 —É—á–∞—Å—Ç–Ω–∏–∫–∞</div>
                    </div>
                    <button class="guild-join-btn" onclick="joinGuild('justice_knights')">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                </div>
                <p>–ì–∏–ª—å–¥–∏—è –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ü–µ–Ω–∏—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å –≤ –ª—é–±—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö</p>
                <p><strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong> –ß–µ—Å—Ç—å 30+ | <strong>–ë–æ–Ω—É—Å:</strong> –£–¥–≤–æ–µ–Ω–Ω—ã–π –æ–ø—ã—Ç –∑–∞ —á–µ—Å—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è</p>
            </div>
            
            <div class="guild-card">
                <div class="guild-header">
                    <div>
                        <div class="guild-name">üß† –ú—É–¥—Ä–µ—Ü—ã –ü—É—Ç–∏</div>
                        <div class="guild-members">38 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                    </div>
                    <button class="guild-join-btn" onclick="joinGuild('wise_sages')">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                </div>
                <p>–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –º—ã—Å–ª–∏—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∏—â—É—Ç –≥–ª—É–±–∏–Ω–Ω—ã–π —Å–º—ã—Å–ª –≤ –∫–∞–∂–¥–æ–º —Ä–µ—à–µ–Ω–∏–∏</p>
                <p><strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong> –ú—É–¥—Ä–æ—Å—Ç—å 25+ | <strong>–ë–æ–Ω—É—Å:</strong> –ë–æ–Ω—É—Å –∫ –º—É–¥—Ä–æ—Å—Ç–∏ –∑–∞ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –≤—ã–±–æ—Ä—ã</p>
            </div>

            <div class="guild-card">
                <div class="guild-header">
                    <div>
                        <div class="guild-name">üí™ –í–æ–∏–Ω—ã –°–∏–ª—ã</div>
                        <div class="guild-members">51 —É—á–∞—Å—Ç–Ω–∏–∫</div>
                    </div>
                    <button class="guild-join-btn" onclick="joinGuild('power_warriors')">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                </div>
                <p>–ì–∏–ª—å–¥–∏—è –¥–ª—è —Ä–µ—à–∏—Ç–µ–ª—å–Ω—ã—Ö –ª–∏–¥–µ—Ä–æ–≤, –≥–æ—Ç–æ–≤—ã—Ö –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è</p>
                <p><strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong> –°–∏–ª–∞ 35+ | <strong>–ë–æ–Ω—É—Å:</strong> –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –æ–ø—ã—Ç –∑–∞ —Å–º–µ–ª—ã–µ –ø–æ—Å—Ç—É–ø–∫–∏</p>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç PvP –¥—É—ç–ª–µ–π -->
        <div class="game-content" id="pvp-content">
            <div class="daily-limits">
                <h3>üìä –î–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã</h3>
                <div class="limit-bar">
                    <div class="limit-fill" id="daily-limit-fill" style="width: 0%"></div>
                </div>
                <p>–û—Å—Ç–∞–ª–æ—Å—å –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è: <span id="remaining-questions">20</span></p>
                <p>–°–±—Ä–æ—Å —á–µ—Ä–µ–∑: <span id="reset-timer">00:00:00</span></p>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π -->
            <div class="friends-section" id="friends-section" style="display: none;">
                <div class="friends-header">
                    üë• –í–∞—à–∏ –¥—Ä—É–∑—å—è
                    <button class="friend-btn invite-btn" onclick="hideFriendsList()" style="float: right; margin-top: -5px;">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                <div id="friends-list"></div>
            </div>

            <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã -->
            <div class="friends-section" id="challenges-section" style="display: none;">
                <div class="friends-header">
                    ‚öîÔ∏è –ê–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã
                    <button class="friend-btn invite-btn" onclick="hideChallengesList()" style="float: right; margin-top: -5px;">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                <div id="challenges-list"></div>
            </div>

            <div class="pvp-arena" id="pvp-arena" style="display: none;">
                <div class="battle-animation">‚öîÔ∏è</div>
                <h2 style="text-align: center; color: #FFD700; margin-bottom: 20px;">‚öîÔ∏è –ú–û–†–ê–õ–¨–ù–ê–Ø –î–£–≠–õ–¨ ‚öîÔ∏è</h2>
                <div class="duel-participants">
                    <div class="duel-player">
                        <div class="duel-player-avatar" id="challenger-avatar">üë§</div>
                        <div class="duel-player-name" id="challenger-name">–ë–æ–µ—Ü 1</div>
                        <div class="duel-score" id="challenger-score">0</div>
                    </div>
                    <div class="duel-vs">VS</div>
                    <div class="duel-player">
                        <div class="duel-player-avatar" id="target-avatar">üë§</div>
                        <div class="duel-player-name" id="target-name">–ë–æ–µ—Ü 2</div>
                        <div class="duel-score" id="target-score">0</div>
                    </div>
                </div>
                <div id="duel-question-container" style="display: none;">
                    <div class="scene-text" id="duel-question-text"></div>
                    <div class="options-container" id="duel-options-container"></div>
                </div>
            </div>

            <!-- –õ–æ–±–±–∏ -->
            <div class="lobby-section" id="lobby-section" style="display: none;">
                <div class="lobby-header">
                    üèÜ –ò–≥—Ä–æ–≤–æ–µ –õ–æ–±–±–∏
                    <button class="friend-btn invite-btn" onclick="hideLobby()" style="float: right; margin-top: -5px;">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                <div class="options-container">
                    <button class="option-btn" onclick="createPublicChallenge()">
                        ‚öîÔ∏è –°–æ–∑–¥–∞—Ç—å –≤—ã–∑–æ–≤
                    </button>
                    <button class="option-btn" onclick="showPublicChallenges()">
                        üìã –ü—É–±–ª–∏—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã
                    </button>
                    <button class="option-btn" onclick="showMyChallenges()">
                        üéØ –ú–æ–∏ –≤—ã–∑–æ–≤—ã
                    </button>
                </div>
                <div id="public-challenges-list"></div>
            </div>

            <!-- –†–µ–π—Ç–∏–Ω–≥–∏ -->
            <div class="lobby-section" id="ratings-section" style="display: none;">
                <div class="lobby-header">
                    üèÖ –†–µ–π—Ç–∏–Ω–≥ –î—É—ç–ª—è–Ω—Ç–æ–≤
                    <button class="friend-btn invite-btn" onclick="hideRatings()" style="float: right; margin-top: -5px;">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                <div class="rating-tabs">
                    <button class="rating-tab active" onclick="showRating('daily')">–î–µ–Ω—å</button>
                    <button class="rating-tab" onclick="showRating('weekly')">–ù–µ–¥–µ–ª—è</button>
                    <button class="rating-tab" onclick="showRating('monthly')">–ú–µ—Å—è—Ü</button>
                </div>
                <div id="ratings-list"></div>
            </div>

            <div class="scene-container">
                <div class="scene-text">
                    üéØ <strong>PvP –î—É—ç–ª–∏</strong> - –°—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –¥—Ä—É–∑—å—è–º–∏ –∏ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –≤ –º–æ—Ä–∞–ª—å–Ω—ã—Ö –ø–æ–µ–¥–∏–Ω–∫–∞—Ö! 
                    –í –¥—É—ç–ª–∏ 10 —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, –≥–¥–µ –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –ø–æ –ª–æ–≥–∏–∫–µ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.
                </div>
                <div class="options-container">
                    <button class="option-btn" onclick="loadFriendsList()">
                        üë• –î—Ä—É–∑—å—è VK
                    </button>
                    <button class="option-btn" onclick="showLobby()">
                        üèÜ –ò–≥—Ä–æ–≤–æ–µ –ª–æ–±–±–∏
                    </button>
                    <button class="option-btn" onclick="showRatings()">
                        üèÖ –†–µ–π—Ç–∏–Ω–≥–∏
                    </button>
                    <button class="option-btn" onclick="showActiveChallenges()">
                        üìã –ú–æ–∏ –≤—ã–∑–æ–≤—ã
                    </button>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
        <div class="game-content" id="tournaments-content">
            <div class="tournament-card">
                <div class="tournament-status">–ê–ö–¢–ò–í–ï–ù</div>
                <div class="tournament-title">üî• –ò—Å–ø—ã—Ç–∞–Ω–∏–µ –ú—É–¥—Ä–æ—Å—Ç–∏</div>
                <p>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä –Ω–∞ –ª—É—á—à–∏–µ —Ä–µ—à–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –º–æ—Ä–∞–ª—å–Ω—ã—Ö –¥–∏–ª–µ–º–º</p>
                <div class="tournament-prize">üèÜ –ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–∑: 5,000 XP</div>
                <button class="guild-join-btn" style="width: 100%; margin-top: 15px;" onclick="joinTournament('weekly_wisdom')">
                    –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å
                </button>
            </div>
            
            <div class="tournament-card">
                <div class="tournament-status">–°–ö–û–†–û</div>
                <div class="tournament-title">‚ö° –ë–∏—Ç–≤–∞ –¢–∏—Ç–∞–Ω–æ–≤</div>
                <p>–ú–µ—Å—è—á–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä –ª—É—á—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞. –¢–æ–ª—å–∫–æ –¥–ª—è 20+ —É—Ä–æ–≤–Ω—è</p>
                <div class="tournament-prize">üèÜ –ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–∑: 20,000 XP + –¢–∏—Ç—É–ª</div>
                <button class="guild-join-btn" style="width: 100%; margin-top: 15px; opacity: 0.5;" disabled>
                    –ù–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 –¥–Ω—è
                </button>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
    <div class="achievement-popup" id="achievement-popup">
        <div class="achievement-icon">üèÜ</div>
        <div class="achievement-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ!</div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let gameData = {
            player: {
                id: "player_" + Date.now(),
                name: "–ù–æ–≤–∏—á–æ–∫",
                level: 1,
                xp: 0,
                xpToNext: 100,
                power: 0,
                wisdom: 0,
                honor: 0,
                totalChoices: 0,
                bossesDefeated: 0,
                achievements: [],
                coins: 1000,
                currentGuild: null,
                guildContribution: 0,
                pvpWins: 0,
                pvpLosses: 0,
                tournamentWins: 0
            },
            currentScene: 0,
            gameStarted: false,
            dailyQuestProgress: 0,
            isBossFight: false,
            currentDuel: null,
            currentTournament: null
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
        let pvpSystem, tournamentSystem, guildSystem, limitationSystem, vkIntegration, lobbySystem;

        // –°—Ü–µ–Ω—ã –∏–≥—Ä—ã
        const gameScenes = [
            {
                scene: "–í—ã –∏–¥–µ—Ç–µ –ø–æ —É–ª–∏—Ü–µ –∏ –≤–∏–¥–∏—Ç–µ, –∫–∞–∫ –≥—Ä—É–ø–ø–∞ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –∏–∑–¥–µ–≤–∞–µ—Ç—Å—è –Ω–∞–¥ –±–µ–∑–¥–æ–º–Ω—ã–º –∫–æ—Ç–µ–Ω–∫–æ–º.",
                options: [
                    "–†–µ—à–∏—Ç–µ–ª—å–Ω–æ –≤–º–µ—à–∏–≤–∞—é—Å—å –∏ –∑–∞—â–∏—â–∞—é –∫–æ—Ç–µ–Ω–∫–∞",
                    "–û—Ç–≤–ª–µ–∫–∞—é –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–º –∏ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ —É–≤–æ–¥—É –∫–æ—Ç–µ–Ω–∫–∞",
                    "–í—ã–∑—ã–≤–∞—é —Å–ª—É–∂–±—É –∑–∞—â–∏—Ç—ã –∂–∏–≤–æ—Ç–Ω—ã—Ö –∏ –Ω–∞–±–ª—é–¥–∞—é –∏–∑–¥–∞–ª–µ–∫–∞"
                ],
                effects: [
                    { power: 15, wisdom: 5, honor: 20, xp: 50 },
                    { power: 5, wisdom: 20, honor: 15, xp: 60 },
                    { power: 0, wisdom: 15, honor: 10, xp: 30 }
                ],
                type: "normal"
            },
            {
                scene: "–í –º–∞–≥–∞–∑–∏–Ω–µ –ø–µ—Ä–µ–¥ –≤–∞–º–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ —Å—Ç–æ–∏—Ç –ø–æ–∂–∏–ª–∞—è –∂–µ–Ω—â–∏–Ω–∞ —Å –æ–¥–Ω–∏–º —Ç–æ–≤–∞—Ä–æ–º, –∞ —É –≤–∞—Å –ø–æ–ª–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞.",
                options: [
                    "–ü—Ä–µ–¥–ª–∞–≥–∞—é –µ–π –ø—Ä–æ–π—Ç–∏ –≤–ø–µ—Ä–µ–¥",
                    "–ü–æ–º–æ–≥–∞—é –¥–æ–Ω–µ—Å—Ç–∏ –µ–µ –ø–æ–∫—É–ø–∫–∏ –¥–æ –¥–æ–º–∞",
                    "–û—Å—Ç–∞—é—Å—å –≤ –æ—á–µ—Ä–µ–¥–∏, —ç—Ç–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ"
                ],
                effects: [
                    { power: 5, wisdom: 10, honor: 15, xp: 40 },
                    { power: 10, wisdom: 15, honor: 25, xp: 70 },
                    { power: 0, wisdom: 5, honor: 5, xp: 20 }
                ],
                type: "normal"
            },
            {
                scene: "üî• –ë–û–°–°-–°–ò–¢–£–ê–¶–ò–Ø: –í–∞—à –ª—É—á—à–∏–π –¥—Ä—É–≥ –ø–æ–ø—Ä–æ—Å–∏–ª –≤–∞—Å —Å–æ–ª–≥–∞—Ç—å –µ–≥–æ –∂–µ–Ω–µ –æ —Ç–æ–º, –≥–¥–µ –æ–Ω –±—ã–ª –≤—á–µ—Ä–∞ –≤–µ—á–µ—Ä–æ–º. –í—ã –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –æ–Ω –∏–∑–º–µ–Ω—è–µ—Ç –µ–π.",
                options: [
                    "–û—Ç–∫–∞–∑—ã–≤–∞—é—Å—å –ª–≥–∞—Ç—å –∏ –≥–æ–≤–æ—Ä—é –ø—Ä–∞–≤–¥—É –∂–µ–Ω–µ",
                    "–£–±–µ–∂–¥–∞—é –¥—Ä—É–≥–∞ —Å–∞–º–æ–º—É –ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è –∂–µ–Ω–µ",
                    "–õ–≥—É —Ä–∞–¥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥—Ä—É–∂–±—ã"
                ],
                effects: [
                    { power: 25, wisdom: 30, honor: 40, xp: 150 },
                    { power: 20, wisdom: 35, honor: 30, xp: 120 },
                    { power: -10, wisdom: -15, honor: -20, xp: 50 }
                ],
                type: "boss"
            }
        ];

        // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        const achievements = [
            { id: "first_choice", name: "–ü–µ—Ä–≤—ã–π —à–∞–≥", description: "–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –≤—ã–±–æ—Ä", icon: "üéØ" },
            { id: "wise_master", name: "–ú–∞—Å—Ç–µ—Ä –º—É–¥—Ä–æ—Å—Ç–∏", description: "–ù–∞–±–µ—Ä–∏—Ç–µ 100 –º—É–¥—Ä–æ—Å—Ç–∏", icon: "üß†" },
            { id: "honor_guard", name: "–°—Ç—Ä–∞–∂ —á–µ—Å—Ç–∏", description: "–ù–∞–±–µ—Ä–∏—Ç–µ 100 —á–µ—Å—Ç–∏", icon: "üõ°Ô∏è" },
            { id: "boss_slayer", name: "–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –±–æ—Å—Å–æ–≤", description: "–ü–æ–±–µ–¥–∏—Ç–µ 5 –±–æ—Å—Å–æ–≤", icon: "‚öîÔ∏è" }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤–µ–∑–¥
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é
        function showSection(section) {
            document.querySelectorAll('.game-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(section + '-content').classList.add('active');
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä–æ–∫–∞
        function updatePlayerUI() {
            document.getElementById('player-level').textContent = gameData.player.level;
            document.getElementById('player-power').textContent = gameData.player.power;
            document.getElementById('player-wisdom').textContent = gameData.player.wisdom;
            document.getElementById('player-honor').textContent = gameData.player.honor;
            
            const xpPercent = (gameData.player.xp / gameData.player.xpToNext) * 100;
            document.getElementById('xp-bar').style.width = xpPercent + '%';
            document.getElementById('xp-text').textContent = `${gameData.player.xp} / ${gameData.player.xpToNext} XP`;
        }

        // –î–æ–±–∞–≤–∏—Ç—å XP
        function addXP(amount) {
            gameData.player.xp += amount;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
            while (gameData.player.xp >= gameData.player.xpToNext) {
                levelUp();
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ª—É—á–µ–Ω–∏—è XP
            showFloatingText(`+${amount} XP`, '#00ff88');
            updatePlayerUI();
        }

        // –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        function levelUp() {
            gameData.player.xp -= gameData.player.xpToNext;
            gameData.player.level++;
            gameData.player.xpToNext = Math.floor(gameData.player.xpToNext * 1.5);
            
            showAchievement(`üéâ –£–†–û–í–ï–ù–¨ ${gameData.player.level}!`, "–í—ã —Å—Ç–∞–ª–∏ —Å–∏–ª—å–Ω–µ–µ!");
            createParticleEffect();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–≤–∞—é—â–∏–π —Ç–µ–∫—Å—Ç
        function showFloatingText(text, color = '#fff') {
            const floating = document.createElement('div');
            floating.className = 'floating-text';
            floating.textContent = text;
            floating.style.color = color;
            floating.style.left = Math.random() * 300 + 100 + 'px';
            floating.style.top = '50%';
            document.body.appendChild(floating);
            
            setTimeout(() => floating.remove(), 2000);
        }

        // –°–æ–∑–¥–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü
        function createParticleEffect() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle-effect';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    particle.style.background = ['#00ff88', '#00aaff', '#ff6b35', '#ffc107'][Math.floor(Math.random() * 4)];
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 1000);
                }, i * 50);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
        function showAchievement(title, description) {
            const popup = document.getElementById('achievement-popup');
            popup.querySelector('.achievement-title').textContent = title;
            popup.classList.add('show');
            
            setTimeout(() => popup.classList.remove('show'), 3000);
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (gameData.player.achievements.includes(achievement.id)) return;
                
                let unlocked = false;
                
                switch (achievement.id) {
                    case "first_choice":
                        unlocked = gameData.player.totalChoices >= 1;
                        break;
                    case "wise_master":
                        unlocked = gameData.player.wisdom >= 100;
                        break;
                    case "honor_guard":
                        unlocked = gameData.player.honor >= 100;
                        break;
                    case "boss_slayer":
                        unlocked = gameData.player.bossesDefeated >= 5;
                        break;
                }
                
                if (unlocked) {
                    gameData.player.achievements.push(achievement.id);
                    showAchievement(`${achievement.icon} ${achievement.name}`, achievement.description);
                    addXP(100);
                }
            });
        }

        // –ù–∞—á–∞—Ç—å –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ
        function startFirstAdventure() {
            gameData.gameStarted = true;
            nextScene();
        }

        // –°–ª–µ–¥—É—é—â–∞—è —Å—Ü–µ–Ω–∞
        function nextScene() {
            if (gameData.currentScene >= gameScenes.length) {
                // –ï—Å–ª–∏ —Å—Ü–µ–Ω—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é
                gameData.currentScene = 0;
            }
            
            const scene = gameScenes[gameData.currentScene];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –±–æ—Å—Å-—Å—Ü–µ–Ω–æ–π
            if (scene.type === "boss") {
                gameData.isBossFight = true;
                document.getElementById('boss-arena').style.display = 'block';
            } else {
                gameData.isBossFight = false;
                document.getElementById('boss-arena').style.display = 'none';
            }
            
            document.getElementById('scene-text').textContent = scene.scene;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            scene.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.onclick = () => makeChoice(index);
                optionsContainer.appendChild(button);
            });
        }

        // –°–¥–µ–ª–∞—Ç—å –≤—ã–±–æ—Ä
        function makeChoice(optionIndex) {
            const scene = gameScenes[gameData.currentScene];
            const effect = scene.effects[optionIndex];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
            gameData.player.power += effect.power || 0;
            gameData.player.wisdom += effect.wisdom || 0;
            gameData.player.honor += effect.honor || 0;
            gameData.player.totalChoices++;
            
            // –î–æ–±–∞–≤–ª—è–µ–º XP
            addXP(effect.xp || 30);
            
            // –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª–∞ –±–æ—Å—Å-–±–∏—Ç–≤–∞
            if (gameData.isBossFight) {
                gameData.player.bossesDefeated++;
                showAchievement("‚öîÔ∏è –ë–û–°–° –ü–û–ë–ï–ñ–î–ï–ù!", "–í—ã —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å —Å–µ—Ä—å–µ–∑–Ω—ã–º –∏—Å–ø—ã—Ç–∞–Ω–∏–µ–º!");
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞
            if (effect.wisdom > 10) {
                gameData.dailyQuestProgress = Math.min(5, gameData.dailyQuestProgress + 1);
                updateDailyQuest();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
            if (effect.power > 0) showFloatingText(`+${effect.power} –°–∏–ª–∞`, '#ff6b35');
            if (effect.wisdom > 0) showFloatingText(`+${effect.wisdom} –ú—É–¥—Ä–æ—Å—Ç—å`, '#00aaff');
            if (effect.honor > 0) showFloatingText(`+${effect.honor} –ß–µ—Å—Ç—å`, '#ffc107');
            
            updatePlayerUI();
            checkAchievements();
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                gameData.currentScene++;
                nextScene();
            }, 2000);
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–≤–µ—Å—Ç
        function updateDailyQuest() {
            const progress = (gameData.dailyQuestProgress / 5) * 100;
            document.getElementById('daily-progress').style.width = progress + '%';
            
            if (gameData.dailyQuestProgress === 5) {
                addXP(200);
                showAchievement("üìÖ –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω!", "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!");
                gameData.dailyQuestProgress = 0; // –°–±—Ä–æ—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
        function showTutorial() {
            alert("üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ü—É—Ç—å –ì–µ—Ä–æ—è!\n\n" +
                  "üìà –ü—Ä–æ–∫–∞—á–∏–≤–∞–π—Ç–µ –°–∏–ª—É, –ú—É–¥—Ä–æ—Å—Ç—å –∏ –ß–µ—Å—Ç—å\n" +
                  "‚öîÔ∏è –°—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –±–æ—Å—Å–∞–º–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π\n" +
                  "üèÜ –°–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ\n" +
                  "‚öîÔ∏è –í—Å—Ç—É–ø–∞–π—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏\n" +
                  "üëë –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö\n" +
                  "üìÖ –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã\n\n" +
                  "–ö–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ!");
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Bridge
        function initVKBridge() {
            if (typeof vkBridge !== 'undefined') {
                vkBridge.send('VKWebAppInit');
                
                vkBridge.subscribe((e) => {
                    if (e.detail.type === 'VKWebAppInitResult') {
                        console.log('VK Bridge –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    }
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function loadGame() {
            const saved = localStorage.getItem('heroPathGame');
            if (saved) {
                gameData = { ...gameData, ...JSON.parse(saved) };
            }
            updatePlayerUI();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            localStorage.setItem('heroPathGame', JSON.stringify(gameData));
        }

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(saveGame, 30000);

        // === PvP –§–£–ù–ö–¶–ò–ò –° VK –ò–ù–¢–ï–ì–†–ê–¶–ò–ï–ô ===
        function loadFriendsList() {
            if (!vkIntegration) {
                alert("VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
            if (!vkIntegration.currentUser) {
                vkIntegration.loadUserData().then(() => {
                    displayFriendsList();
                });
            } else {
                displayFriendsList();
            }
        }

        function displayFriendsList() {
            if (!vkIntegration.currentUser) {
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.");
                return;
            }

            const friendsSection = document.getElementById('friends-section');
            const friendsList = document.getElementById('friends-list');
            
            // –ü–æ–ª—É—á–∞–µ–º –¥—Ä—É–∑–µ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –Ω–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
            const appFriends = vkIntegration.getAppFriends();
            const nonAppFriends = vkIntegration.getNonAppFriends();
            
            let html = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–∑–µ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
            if (appFriends.length > 0) {
                html += '<h4 style="color: #00FF88; margin: 15px 0 10px 0;">‚úÖ –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h4>';
                appFriends.forEach(friend => {
                    html += createFriendItem(friend, true);
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–∑–µ–π –Ω–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
            if (nonAppFriends.length > 0) {
                html += '<h4 style="color: #FFA500; margin: 15px 0 10px 0;">üì± –ù–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h4>';
                nonAppFriends.forEach(friend => {
                    html += createFriendItem(friend, false);
                });
            }
            
            if (html === '') {
                html = '<p style="text-align: center; opacity: 0.7;">–î—Ä—É–∑—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
            }
            
            friendsList.innerHTML = html;
            friendsSection.style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ü–∏–∏
            document.getElementById('challenges-section').style.display = 'none';
            document.getElementById('pvp-arena').style.display = 'none';
        }

        function createFriendItem(friend, isInApp) {
            const statusClass = isInApp ? 'app-user' : 'non-app-user';
            const statusText = isInApp ? '‚úÖ –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏' : 'üì± –ù–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏';
            const statusIcon = isInApp ? 'üéÆ' : 'üì±';
            const actionButton = isInApp ? 
                `<button class="friend-btn challenge-btn" onclick="challengeFriend(${friend.id})">‚öîÔ∏è –í—ã–∑–æ–≤ –Ω–∞ –¥—É—ç–ª—å</button>` :
                `<button class="friend-btn invite-btn" onclick="inviteFriend(${friend.id})">üì® –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤ –∏–≥—Ä—É</button>`;
            
            return `
                <div class="friend-item ${statusClass}">
                    <div class="friend-info">
                        <div class="friend-avatar">${friend.first_name.charAt(0)}${friend.last_name.charAt(0)}</div>
                        <div>
                            <div class="friend-name">${friend.first_name} ${friend.last_name}</div>
                            <div class="friend-status">${statusIcon} ${statusText}</div>
                        </div>
                    </div>
                    <div class="friend-actions">
                        ${actionButton}
                    </div>
                </div>
            `;
        }

        function challengeFriend(friendId) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –Ω–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP –¥–ª—è —Å—Ç–∞–≤–∫–∏
            const maxBet = Math.min(500, gameData.player.xp);
            if (maxBet < 50) {
                alert("–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP –¥–ª—è –≤—ã–∑–æ–≤–∞! –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 50 XP.");
                return;
            }
            
            const bet = parseInt(prompt(`–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É XP (–æ—Ç 50 –¥–æ ${maxBet}):`)) || 100;
            if (bet < 50 || bet > maxBet) {
                alert(`–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 50 –¥–æ ${maxBet} XP`);
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–∑–æ–≤
            vkIntegration.sendDuelChallenge(friendId, bet).then(challenge => {
                if (challenge) {
                    alert(`‚öîÔ∏è –í—ã–∑–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥—Ä—É–≥—É! –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ–Ω –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥—É—ç–ª–∏.`);
                } else {
                    alert("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã–∑–æ–≤–∞");
                }
            });
        }

        function inviteFriend(friendId) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            if (confirm("–•–æ—Ç–∏—Ç–µ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞ –≤ –∏–≥—Ä—É? –û–Ω –ø–æ–ª—É—á–∏—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ VK.")) {
                vkIntegration.inviteFriend(friendId).then(success => {
                    if (success) {
                        alert("üì± –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ö–æ–≥–¥–∞ –¥—Ä—É–≥ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—Å—è –∫ –∏–≥—Ä–µ, –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤—ã–∑–≤–∞—Ç—å –µ–≥–æ –Ω–∞ –¥—É—ç–ª—å.");
                    } else {
                        alert("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è");
                    }
                });
            }
        }

        function showActiveChallenges() {
            if (!vkIntegration || !vkIntegration.currentUser) {
                alert("VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
                return;
            }

            const challengesSection = document.getElementById('challenges-section');
            const challengesList = document.getElementById('challenges-list');
            
            const challenges = vkIntegration.getActiveChallenges();
            
            if (challenges.length === 0) {
                challengesList.innerHTML = '<p style="text-align: center; opacity: 0.7;">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤</p>';
            } else {
                let html = '';
                challenges.forEach(challenge => {
                    html += `
                        <div class="friend-item app-user">
                            <div class="friend-info">
                                <div class="friend-avatar">${challenge.challengerName.split(' ').map(n => n.charAt(0)).join('')}</div>
                                <div>
                                    <div class="friend-name">${challenge.challengerName}</div>
                                    <div class="friend-status">–°—Ç–∞–≤–∫–∞: ${challenge.bet} XP</div>
                                </div>
                            </div>
                            <div class="friend-actions">
                                <button class="friend-btn challenge-btn" onclick="acceptChallenge(${challenge.id})">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
                                <button class="friend-btn invite-btn" onclick="declineChallenge(${challenge.id})">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                    `;
                });
                challengesList.innerHTML = html;
            }
            
            challengesSection.style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ü–∏–∏
            document.getElementById('friends-section').style.display = 'none';
            document.getElementById('pvp-arena').style.display = 'none';
        }

        function acceptChallenge(challengeId) {
            const challenge = vkIntegration.acceptChallenge(challengeId);
            if (challenge) {
                // –°–æ–∑–¥–∞–µ–º –¥—É—ç–ª—å –≤ PvP —Å–∏—Å—Ç–µ–º–µ
                const duel = pvpSystem.acceptChallenge(challengeId, gameData.player.name);
                if (duel) {
                    gameData.currentDuel = duel;
                    startPvPDuel(duel);
                }
            }
        }

        function declineChallenge(challengeId) {
            const success = vkIntegration.declineChallenge(challengeId);
            if (success) {
                alert("–í—ã–∑–æ–≤ –æ—Ç–∫–ª–æ–Ω–µ–Ω");
                showActiveChallenges(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            }
        }

        function hideFriendsList() {
            document.getElementById('friends-section').style.display = 'none';
        }

        function hideChallengesList() {
            document.getElementById('challenges-section').style.display = 'none';
        }

        // === –§–£–ù–ö–¶–ò–ò –õ–û–ë–ë–ò ===
        function showLobby() {
            document.getElementById('lobby-section').style.display = 'block';
            document.getElementById('friends-section').style.display = 'none';
            document.getElementById('challenges-section').style.display = 'none';
            document.getElementById('ratings-section').style.display = 'none';
            document.getElementById('pvp-arena').style.display = 'none';
        }

        function hideLobby() {
            document.getElementById('lobby-section').style.display = 'none';
        }

        function showRatings() {
            document.getElementById('ratings-section').style.display = 'block';
            document.getElementById('friends-section').style.display = 'none';
            document.getElementById('challenges-section').style.display = 'none';
            document.getElementById('lobby-section').style.display = 'none';
            document.getElementById('pvp-arena').style.display = 'none';
            showRating('daily'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–Ω–µ–≤–Ω–æ–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }

        function hideRatings() {
            document.getElementById('ratings-section').style.display = 'none';
        }

        function createPublicChallenge() {
            const maxBet = Math.min(500, gameData.player.xp);
            if (maxBet < 50) {
                alert("–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã–∑–æ–≤–∞! –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 50 XP.");
                return;
            }
            
            const bet = parseInt(prompt(`–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É XP (–æ—Ç 50 –¥–æ ${maxBet}):`)) || 100;
            if (bet < 50 || bet > maxBet) {
                alert(`–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 50 –¥–æ ${maxBet} XP`);
                return;
            }
            
            const minLevel = parseInt(prompt("–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –≤—ã–∑–æ–≤–∞ (1-20):")) || 1;
            if (minLevel < 1 || minLevel > 20) {
                alert("–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 20");
                return;
            }
            
            const challenge = lobbySystem.createPublicChallenge(gameData.player, bet, minLevel);
            if (challenge) {
                alert(`üèÜ –ü—É–±–ª–∏—á–Ω—ã–π –≤—ã–∑–æ–≤ —Å–æ–∑–¥–∞–Ω! –°—Ç–∞–≤–∫–∞: ${bet} XP, –º–∏–Ω. —É—Ä–æ–≤–µ–Ω—å: ${minLevel}`);
                showPublicChallenges();
            }
        }

        function showPublicChallenges() {
            const challenges = lobbySystem.getActiveChallenges();
            const challengesList = document.getElementById('public-challenges-list');
            
            if (challenges.length === 0) {
                challengesList.innerHTML = '<p style="text-align: center; opacity: 0.7;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤</p>';
                return;
            }
            
            let html = '<h4 style="color: #FFC107; margin: 15px 0 10px 0;">‚öîÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤—ã–∑–æ–≤—ã</h4>';
            challenges.forEach(challenge => {
                if (challenge.challenger !== gameData.player.id) { // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–æ–∏ –≤—ã–∑–æ–≤—ã
                    html += createPublicChallengeItem(challenge);
                }
            });
            
            challengesList.innerHTML = html;
        }

        function createPublicChallengeItem(challenge) {
            const canAccept = gameData.player.level >= challenge.minLevel && gameData.player.xp >= challenge.bet;
            const acceptButton = canAccept ? 
                `<button class="friend-btn challenge-btn" onclick="acceptPublicChallenge(${challenge.id})">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>` :
                `<button class="friend-btn invite-btn" disabled style="opacity: 0.5;">‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>`;
            
            return `
                <div class="public-challenge">
                    <div class="challenge-info">
                        <div class="challenger-info">
                            <div class="challenger-avatar">${challenge.challengerName.charAt(0)}</div>
                            <div>
                                <div class="friend-name">${challenge.challengerName}</div>
                                <div class="friend-status">–£—Ä–æ–≤–µ–Ω—å ${challenge.challengerLevel}</div>
                            </div>
                        </div>
                        <div class="challenge-details">
                            <div class="challenge-bet">${challenge.bet} XP</div>
                            <div class="challenge-level">–ú–∏–Ω. —É—Ä–æ–≤–µ–Ω—å: ${challenge.minLevel}</div>
                        </div>
                    </div>
                    <div class="challenge-actions">
                        ${acceptButton}
                    </div>
                </div>
            `;
        }

        function acceptPublicChallenge(challengeId) {
            const result = lobbySystem.acceptPublicChallenge(challengeId, gameData.player);
            if (result && !result.error) {
                alert(`‚öîÔ∏è –í—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç! –ù–∞—á–∏–Ω–∞–µ–º –¥—É—ç–ª—å —Å ${result.challengerName}`);
                // –°–æ–∑–¥–∞–µ–º –¥—É—ç–ª—å –≤ PvP —Å–∏—Å—Ç–µ–º–µ
                const duel = pvpSystem.acceptChallenge(challengeId, gameData.player.name);
                if (duel) {
                    gameData.currentDuel = duel;
                    startPvPDuel(duel);
                }
            } else if (result && result.error) {
                alert(`‚ùå ${result.error}`);
            } else {
                alert("‚ùå –í—ã–∑–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
            }
        }

        function showMyChallenges() {
            const challenges = lobbySystem.getActiveChallenges();
            const myChallenges = challenges.filter(c => c.challenger === gameData.player.id);
            const challengesList = document.getElementById('public-challenges-list');
            
            if (myChallenges.length === 0) {
                challengesList.innerHTML = '<p style="text-align: center; opacity: 0.7;">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤</p>';
                return;
            }
            
            let html = '<h4 style="color: #FFC107; margin: 15px 0 10px 0;">üéØ –ú–æ–∏ –≤—ã–∑–æ–≤—ã</h4>';
            myChallenges.forEach(challenge => {
                html += `
                    <div class="public-challenge">
                        <div class="challenge-info">
                            <div class="challenger-info">
                                <div class="challenger-avatar">${challenge.challengerName.charAt(0)}</div>
                                <div>
                                    <div class="friend-name">${challenge.challengerName}</div>
                                    <div class="friend-status">–°—Ç–∞–≤–∫–∞: ${challenge.bet} XP</div>
                                </div>
                            </div>
                            <div class="challenge-details">
                                <div class="challenge-level">–ú–∏–Ω. —É—Ä–æ–≤–µ–Ω—å: ${challenge.minLevel}</div>
                                <div class="friend-status">–û–∂–∏–¥–∞–µ—Ç...</div>
                            </div>
                        </div>
                        <div class="challenge-actions">
                            <button class="friend-btn invite-btn" onclick="cancelPublicChallenge(${challenge.id})">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            });
            
            challengesList.innerHTML = html;
        }

        function cancelPublicChallenge(challengeId) {
            if (confirm("–û—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –≤—ã–∑–æ–≤?")) {
                const success = lobbySystem.cancelChallenge(challengeId, gameData.player.id);
                if (success) {
                    alert("–í—ã–∑–æ–≤ –æ—Ç–º–µ–Ω–µ–Ω");
                    showMyChallenges();
                }
            }
        }

        function showRating(period) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.rating-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const ratings = lobbySystem.getTopPlayers(period, 10);
            const ratingsList = document.getElementById('ratings-list');
            
            if (ratings.length === 0) {
                ratingsList.innerHTML = '<p style="text-align: center; opacity: 0.7;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</p>';
                return;
            }
            
            let html = '';
            ratings.forEach((player, index) => {
                const rank = index + 1;
                const rankIcon = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `${rank}.`;
                
                html += `
                    <div class="rating-item">
                        <div class="rating-rank">${rankIcon}</div>
                        <div class="rating-player">
                            <div class="friend-name">${player.playerName}</div>
                            <div class="friend-status">–†–µ–π—Ç–∏–Ω–≥: ${player.rating}</div>
                        </div>
                        <div class="rating-stats">
                            <div>–ü–æ–±–µ–¥—ã: ${player.wins}</div>
                            <div>–ü–æ—Ä–∞–∂–µ–Ω–∏—è: ${player.losses}</div>
                            <div>–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫: ${player.totalBet} XP</div>
                        </div>
                    </div>
                `;
            });
            
            ratingsList.innerHTML = html;
        }

        function acceptPvPChallenge(challengeId) {
            const duel = pvpSystem.acceptChallenge(challengeId, gameData.player.name);
            if (duel) {
                gameData.currentDuel = duel;
                startPvPDuel(duel);
            }
        }

        function startPvPDuel(duel) {
            document.getElementById('pvp-arena').style.display = 'block';
            document.getElementById('challenger-name').textContent = duel.challenger;
            document.getElementById('target-name').textContent = duel.target;
            document.getElementById('challenger-score').textContent = '0';
            document.getElementById('target-score').textContent = '0';
            
            showNextDuelQuestion(duel);
        }

        function showNextDuelQuestion(duel) {
            if (duel.currentQuestion >= duel.questions.length) {
                finishDuel(duel);
                return;
            }
            
            const question = duel.questions[duel.currentQuestion];
            document.getElementById('duel-question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('duel-options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.onclick = () => answerDuelQuestion(index);
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('duel-question-container').style.display = 'block';
        }

        function answerDuelQuestion(answerIndex) {
            const startTime = Date.now();
            const result = pvpSystem.answerDuelQuestion(gameData.currentDuel.id, gameData.player.name, answerIndex, 0);
            
            if (result.type === 'answer') {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
                if (gameData.currentDuel.challenger === gameData.player.name) {
                    gameData.currentDuel.challengerScore = result.currentScore;
                    document.getElementById('challenger-score').textContent = result.currentScore;
                } else {
                    gameData.currentDuel.targetScore = result.currentScore;
                    document.getElementById('target-score').textContent = result.currentScore;
                }
                
                showFloatingText(`+${result.score}`, '#FF4500');
                
                setTimeout(() => {
                    showNextDuelQuestion(gameData.currentDuel);
                }, 2000);
            } else if (result.type === 'finished') {
                finishDuel(result);
            }
        }

        function finishDuel(result) {
            const isWinner = result.winner === gameData.player.name;
            const message = isWinner ? 
                `üèÜ –ü–û–ë–ï–î–ê! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${result.bet} XP!` : 
                `üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ ${result.bet} XP`;
            
            if (isWinner) {
                gameData.player.pvpWins++;
                addXP(result.bet);
            } else {
                gameData.player.pvpLosses++;
                gameData.player.xp = Math.max(0, gameData.player.xp - result.bet);
            }
            
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–±–±–∏ —Å–∏—Å—Ç–µ–º—É
            const winner = isWinner ? gameData.player : { id: 'opponent', name: result.winner };
            const loser = isWinner ? { id: 'opponent', name: result.loser } : gameData.player;
            lobbySystem.recordDuelResult(winner, loser, result.bet);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const resultMessage = message + '\n\n–•–æ—Ç–∏—Ç–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º?';
            if (confirm(resultMessage)) {
                vkIntegration.shareDuelResult({
                    isWinner: isWinner,
                    bet: result.bet,
                    opponent: isWinner ? result.loser : result.winner
                });
            }
            
            document.getElementById('pvp-arena').style.display = 'none';
            gameData.currentDuel = null;
            updatePlayerUI();
        }

        function showPvPHistory() {
            const wins = gameData.player.pvpWins;
            const losses = gameData.player.pvpLosses;
            const total = wins + losses;
            const winRate = total > 0 ? Math.round((wins / total) * 100) : 0;
            
            alert(`üìä –ò—Å—Ç–æ—Ä–∏—è PvP –¥—É—ç–ª–µ–π:\n\n–ü–æ–±–µ–¥—ã: ${wins}\n–ü–æ—Ä–∞–∂–µ–Ω–∏—è: ${losses}\n–í—Å–µ–≥–æ: ${total}\n–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ${winRate}%`);
        }

        // === –¢–£–†–ù–ò–†–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
        function joinTournament(tournamentId) {
            const result = tournamentSystem.registerForTournament(tournamentId, gameData.player);
            if (result) {
                alert("–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ —Ç—É—Ä–Ω–∏—Ä!");
            } else {
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞.");
            }
        }

        // === –ì–ò–õ–¨–î–ï–ô–°–ö–ò–ï –§–£–ù–ö–¶–ò–ò ===
        function joinGuild(guildId) {
            const result = guildSystem.joinGuild(guildId, gameData.player);
            if (result.success) {
                gameData.player.currentGuild = guildId;
                updateGuildUI();
                alert(result.message);
            } else {
                alert(result.message);
            }
        }

        function leaveCurrentGuild() {
            const result = guildSystem.leaveGuild(gameData.player.id);
            if (result.success) {
                gameData.player.currentGuild = null;
                gameData.player.guildContribution = 0;
                updateGuildUI();
                alert(result.message);
            } else {
                alert(result.message);
            }
        }

        function contributeToGuild() {
            if (!gameData.player.currentGuild) return;
            
            const result = guildSystem.contributeToGuild(gameData.player.id, 100);
            if (result.success) {
                gameData.player.guildContribution += 100;
                gameData.player.xp = Math.max(0, gameData.player.xp - 100);
                updateGuildUI();
                updatePlayerUI();
                alert(result.message);
            } else {
                alert(result.message);
            }
        }

        function updateGuildUI() {
            const currentGuildInfo = document.getElementById('current-guild-info');
            
            if (gameData.player.currentGuild) {
                const guild = guildSystem.guilds.get(gameData.player.currentGuild);
                if (guild) {
                    document.getElementById('current-guild-name').textContent = guild.name;
                    document.getElementById('current-guild-members').textContent = `${guild.members.length} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;
                    document.getElementById('current-guild-description').textContent = guild.description;
                    document.getElementById('player-contribution').textContent = gameData.player.guildContribution;
                    currentGuildInfo.style.display = 'block';
                }
            } else {
                currentGuildInfo.style.display = 'none';
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –õ–ò–ú–ò–¢–û–í ===
        function updateLimitsUI() {
            const limits = limitationSystem.getLimitsInfo(gameData.player.id);
            const remaining = limits.remaining;
            const total = limits.limit;
            
            document.getElementById('remaining-questions').textContent = remaining;
            document.getElementById('daily-limit-fill').style.width = ((total - remaining) / total * 100) + '%';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä —Å–±—Ä–æ—Å–∞
            updateResetTimer();
        }

        function updateResetTimer() {
            const timeUntilReset = limitationSystem.getTimeUntilReset(gameData.player.id);
            const hours = Math.floor(timeUntilReset / (1000 * 60 * 60));
            const minutes = Math.floor((timeUntilReset % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeUntilReset % (1000 * 60)) / 1000);
            
            document.getElementById('reset-timer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é makeChoice –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–∏–º–∏—Ç–∞–º–∏
        function makeChoice(optionIndex) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã
            if (!limitationSystem.canAnswerQuestion(gameData.player.id)) {
                alert("–í—ã –∏—Å—á–µ—Ä–ø–∞–ª–∏ –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –≤–æ–ø—Ä–æ—Å–æ–≤! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –∏–ª–∏ —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ PvP –¥—É—ç–ª—è—Ö!");
                return;
            }

            const scene = gameScenes[gameData.currentScene];
            const effect = scene.effects[optionIndex];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
            gameData.player.power += effect.power || 0;
            gameData.player.wisdom += effect.wisdom || 0;
            gameData.player.honor += effect.honor || 0;
            gameData.player.totalChoices++;
            
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –≤ –ª–∏–º–∏—Ç—ã
            limitationSystem.recordQuestionAnswer(gameData.player.id);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–æ–Ω—É—Å—ã –≥–∏–ª—å–¥–∏–∏
            const guildBonus = guildSystem.getGuildBonus(gameData.player.id);
            let xpGain = effect.xp || 30;
            
            if (guildBonus) {
                if (guildBonus.honorMultiplier && effect.honor > 0) {
                    xpGain = Math.floor(xpGain * guildBonus.honorMultiplier);
                }
                if (guildBonus.xpBonus) {
                    xpGain += guildBonus.xpBonus;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º XP
            addXP(xpGain);
            
            // –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª–∞ –±–æ—Å—Å-–±–∏—Ç–≤–∞
            if (gameData.isBossFight) {
                gameData.player.bossesDefeated++;
                showAchievement("‚öîÔ∏è –ë–û–°–° –ü–û–ë–ï–ñ–î–ï–ù!", "–í—ã —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å —Å–µ—Ä—å–µ–∑–Ω—ã–º –∏—Å–ø—ã—Ç–∞–Ω–∏–µ–º!");
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞
            if (effect.wisdom > 10) {
                gameData.dailyQuestProgress = Math.min(5, gameData.dailyQuestProgress + 1);
                updateDailyQuest();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
            if (effect.power > 0) showFloatingText(`+${effect.power} –°–∏–ª–∞`, '#ff6b35');
            if (effect.wisdom > 0) showFloatingText(`+${effect.wisdom} –ú—É–¥—Ä–æ—Å—Ç—å`, '#00aaff');
            if (effect.honor > 0) showFloatingText(`+${effect.honor} –ß–µ—Å—Ç—å`, '#ffc107');
            
            updatePlayerUI();
            updateLimitsUI();
            checkAchievements();
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                gameData.currentScene++;
                nextScene();
            }, 2000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            createStars();
            loadGame();
            initVKBridge();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã
            pvpSystem = new GameSystems.PvPSystem();
            tournamentSystem = new GameSystems.TournamentSystem();
            guildSystem = new GameSystems.GuildSystem();
            limitationSystem = new GameSystems.LimitationSystem();
            vkIntegration = new VKIntegration();
            lobbySystem = new LobbySystem();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateGuildUI();
            updateLimitsUI();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            setInterval(updateResetTimer, 1000);
            
            setTimeout(() => {
                document.body.classList.add('loaded');
            }, 2000);
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
        window.addEventListener('beforeunload', saveGame);
    </script>
</body>
</html>
