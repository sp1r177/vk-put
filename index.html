<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>–ü—É—Ç—å - –ò–≥—Ä–∞ –≤—ã–±–æ—Ä–æ–≤</title>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            background: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .screen {
            display: none;
            padding: 20px;
            min-height: 100vh;
        }

        .screen.active {
            display: block;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1rem;
        }

        .btn {
            width: 100%;
            padding: 15px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .stats-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .game-scene {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .scene-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .option-btn {
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-bar {
            background: #f0f0f0;
            border-radius: 10px;
            padding: 10px;
        }

        .stat-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-progress {
            background: #e0e0e0;
            border-radius: 5px;
            height: 8px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debug-info">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div class="screen active" id="main-screen">
            <div class="header">
                <div class="logo">–ü—É—Ç—å</div>
                <div class="subtitle">–ò–≥—Ä–∞ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤</div>
            </div>
            
            <div class="stats-summary">
                <div class="stat-card">
                    <div class="stat-value" id="decisions-count">0</div>
                    <div class="stat-label">–†–µ—à–µ–Ω–∏–π –ø—Ä–∏–Ω—è—Ç–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="current-level">–ù–æ–≤–∏—á–æ–∫</div>
                    <div class="stat-label">–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startGame()">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="btn btn-secondary" onclick="showProfile()">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
            <button class="btn btn-secondary" onclick="showInstructions()">üìñ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</button>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div class="screen" id="game-screen">
            <div class="game-scene">
                <div class="scene-text" id="scene-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ü–µ–Ω—ã...</div>
                <div id="scene-options"></div>
            </div>
            <button class="btn btn-secondary" onclick="showMain()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
        <div class="screen" id="result-screen">
            <div class="header">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–±–æ—Ä–∞</h2>
            </div>
            <div id="result-text"></div>
            <button class="btn btn-primary" onclick="loadRandomScene()">‚û°Ô∏è –°–ª–µ–¥—É—é—â–∞—è —Å—Ü–µ–Ω–∞</button>
            <button class="btn btn-secondary" onclick="showMain()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div class="screen" id="profile-screen">
            <div class="header">
                <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
            </div>
            <div class="profile-stats" id="profile-stats"></div>
            <button class="btn btn-secondary" onclick="showMain()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>

        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div class="screen" id="instructions-screen">
            <div class="header">
                <h2>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h2>
            </div>
            <p>–í –∏–≥—Ä–µ "–ü—É—Ç—å" –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —Ä–µ—à–µ–Ω–∏—è –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. –ö–∞–∂–¥—ã–π –≤—ã–±–æ—Ä –≤–ª–∏—è–µ—Ç –Ω–∞ —á–µ—Ç—ã—Ä–µ –∞—Å–ø–µ–∫—Ç–∞ –≤–∞—à–µ–π –ª–∏—á–Ω–æ—Å—Ç–∏:</p>
            <ul style="margin: 20px 0; padding-left: 20px;">
                <li><strong>–≠–º–ø–∞—Ç–∏—è</strong> - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π</li>
                <li><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</strong> - –≤–µ—Ä–∞ –≤ —Å–µ–±—è</li>
                <li><strong>–≠–≥–æ–∏–∑–º</strong> - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–≤–æ–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤</li>
                <li><strong>–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å</strong> - –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏</li>
            </ul>
            <button class="btn btn-secondary" onclick="showMain()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let playerStats = {
            empathy: 50,
            confidence: 50,
            ego: 50,
            clarity: 50,
            decisionsCount: 0,
            completedScenes: []
        };

        let currentScene = null;
        
        // –ü—Ä–æ—Å—Ç—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å—Ü–µ–Ω—ã
        const gameScenes = [
            {
                scene: "–í–∞—à –¥—Ä—É–≥ –ø—Ä–æ—Å–∏—Ç –¥–µ–Ω–µ–≥ –≤ –¥–æ–ª–≥. –£ –≤–∞—Å –µ—Å—Ç—å –¥–µ–Ω—å–≥–∏, –Ω–æ –æ–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è –≤–∞–∂–Ω–æ–π –ø–æ–∫—É–ø–∫–∏.",
                options: [
                    "–î–∞—é –¥–µ–Ω—å–≥–∏, –¥—Ä—É–∑—å—è –≤–∞–∂–Ω–µ–µ",
                    "–û—Ç–∫–∞–∑—ã–≤–∞—é, –æ–±—ä—è—Å–Ω—è—è —Å–∏—Ç—É–∞—Ü–∏—é",
                    "–î–∞—é, –Ω–æ —Å—Ç–∞–≤–ª—é —É—Å–ª–æ–≤–∏—è"
                ],
                effects: [
                    { empathy: 15, confidence: -5, ego: -10, clarity: 5 },
                    { empathy: 5, confidence: 10, ego: 5, clarity: 15 },
                    { empathy: 0, confidence: 5, ego: 10, clarity: 10 }
                ]
            },
            {
                scene: "–í –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –≤—ã –≤–∏–¥–∏—Ç–µ —Ç—Ä–∞–≤–ª—é –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞. –ï–≥–æ –º–Ω–µ–Ω–∏–µ –≤–∞–º –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –Ω–æ —Ç—Ä–∞–≤–ª—è –∂–µ—Å—Ç–æ–∫–∞—è.",
                options: [
                    "–ó–∞—Å—Ç—É–ø–∞—é—Å—å –ø—É–±–ª–∏—á–Ω–æ",
                    "–ü–∏—à—É –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
                    "–ù–µ –≤–º–µ—à–∏–≤–∞—é—Å—å"
                ],
                effects: [
                    { empathy: 20, confidence: 10, ego: -5, clarity: 5 },
                    { empathy: 15, confidence: 0, ego: 0, clarity: 10 },
                    { empathy: -10, confidence: -5, ego: 10, clarity: 0 }
                ]
            },
            {
                scene: "–ö–æ–ª–ª–µ–≥–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–∞ –¥—Ä—É–≥–∏—Ö. –°–µ–≥–æ–¥–Ω—è –æ–Ω –ø—Ä–æ—Å–∏—Ç –ø–æ–º–æ—á—å —Å –µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–º.",
                options: [
                    "–ü–æ–º–æ–≥–∞—é, –Ω–æ –æ–±—ä—è—Å–Ω—è—é –≥—Ä–∞–Ω–∏—Ü—ã",
                    "–û—Ç–∫–∞–∑—ã–≤–∞—é—Å—å –∏ –∏–¥—É –∫ –Ω–∞—á–∞–ª—å—Å—Ç–≤—É",
                    "–°–æ–≥–ª–∞—à–∞—é—Å—å, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ä—Ç–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è"
                ],
                effects: [
                    { empathy: 5, confidence: 15, ego: 0, clarity: 15 },
                    { empathy: 0, confidence: 20, ego: 5, clarity: 10 },
                    { empathy: 10, confidence: -10, ego: -5, clarity: -10 }
                ]
            }
        ];

        // Debug —Ñ—É–Ω–∫—Ü–∏–∏
        function debugLog(message) {
            console.log(message);
            const debugDiv = document.getElementById('debug-info');
            if (debugDiv) {
                debugDiv.innerHTML += '<br>' + message;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            debugLog(`–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω: ${screenId}`);
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showMain() {
            updateMainScreen();
            showScreen('main-screen');
        }

        function showProfile() {
            updateProfile();
            showScreen('profile-screen');
        }

        function showInstructions() {
            showScreen('instructions-screen');
        }

        function startGame() {
            loadRandomScene();
            showScreen('game-screen');
        }

        // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
        function loadRandomScene() {
            debugLog('–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Å—Ü–µ–Ω—É');
            const sceneIndex = Math.floor(Math.random() * gameScenes.length);
            currentScene = { ...gameScenes[sceneIndex], index: sceneIndex };
            
            document.getElementById('scene-text').textContent = currentScene.scene;
            
            const optionsDiv = document.getElementById('scene-options');
            optionsDiv.innerHTML = '';
            
            currentScene.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => makeChoice(index);
                optionsDiv.appendChild(btn);
            });
        }

        function makeChoice(choiceIndex) {
            debugLog(`–í—ã–±–æ—Ä —Å–¥–µ–ª–∞–Ω: ${choiceIndex}`);
            if (!currentScene) return;
            
            const effect = currentScene.effects[choiceIndex];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
            playerStats.empathy = Math.max(0, Math.min(100, playerStats.empathy + effect.empathy));
            playerStats.confidence = Math.max(0, Math.min(100, playerStats.confidence + effect.confidence));
            playerStats.ego = Math.max(0, Math.min(100, playerStats.ego + effect.ego));
            playerStats.clarity = Math.max(0, Math.min(100, playerStats.clarity + effect.clarity));
            playerStats.decisionsCount++;
            
            saveProgress();
            showResult(choiceIndex, effect);
        }

        function showResult(choiceIndex, effect) {
            const resultDiv = document.getElementById('result-text');
            resultDiv.innerHTML = `
                <div class="game-scene">
                    <p><strong>–í–∞—à –≤—ã–±–æ—Ä:</strong> ${currentScene.options[choiceIndex]}</p>
                    <p><strong>–ò–∑–º–µ–Ω–µ–Ω–∏—è:</strong></p>
                    <ul>
                        ${effect.empathy !== 0 ? `<li>–≠–º–ø–∞—Ç–∏—è: ${effect.empathy > 0 ? '+' : ''}${effect.empathy}</li>` : ''}
                        ${effect.confidence !== 0 ? `<li>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${effect.confidence > 0 ? '+' : ''}${effect.confidence}</li>` : ''}
                        ${effect.ego !== 0 ? `<li>–≠–≥–æ–∏–∑–º: ${effect.ego > 0 ? '+' : ''}${effect.ego}</li>` : ''}
                        ${effect.clarity !== 0 ? `<li>–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å: ${effect.clarity > 0 ? '+' : ''}${effect.clarity}</li>` : ''}
                    </ul>
                </div>
            `;
            showScreen('result-screen');
        }

        function updateMainScreen() {
            document.getElementById('decisions-count').textContent = playerStats.decisionsCount;
            
            const level = playerStats.decisionsCount < 10 ? '–ù–æ–≤–∏—á–æ–∫' :
                         playerStats.decisionsCount < 30 ? '–ò—Å–∫–∞—Ç–µ–ª—å' :
                         playerStats.decisionsCount < 60 ? '–ú—É–¥—Ä–µ—Ü' : '–ì—É—Ä—É';
            
            document.getElementById('current-level').textContent = level;
        }

        function updateProfile() {
            const profileDiv = document.getElementById('profile-stats');
            const stats = [
                { name: '–≠–º–ø–∞—Ç–∏—è', value: playerStats.empathy, color: '#e74c3c' },
                { name: '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å', value: playerStats.confidence, color: '#3498db' },
                { name: '–≠–≥–æ–∏–∑–º', value: playerStats.ego, color: '#f39c12' },
                { name: '–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å', value: playerStats.clarity, color: '#27ae60' }
            ];
            
            profileDiv.innerHTML = stats.map(stat => `
                <div class="stat-bar">
                    <div class="stat-name">${stat.name}</div>
                    <div class="stat-progress">
                        <div class="stat-fill" style="width: ${stat.value}%; background: ${stat.color}"></div>
                    </div>
                    <div style="text-align: center; margin-top: 5px; font-weight: bold;">${stat.value}%</div>
                </div>
            `).join('');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞
        function saveProgress() {
            try {
                localStorage.setItem('putGame_progress', JSON.stringify(playerStats));
                debugLog('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
            } catch (e) {
                debugLog('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
            }
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('putGame_progress');
                if (saved) {
                    playerStats = { ...playerStats, ...JSON.parse(saved) };
                    debugLog('–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
            } catch (e) {
                debugLog('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e.message);
            }
        }

        // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Bridge
        function initVK() {
            debugLog('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK...');
            
            if (window.vkBridge) {
                debugLog('VK Bridge –Ω–∞–π–¥–µ–Ω');
                try {
                    vkBridge.send('VKWebAppInit');
                    debugLog('VK Bridge –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                } catch (e) {
                    debugLog('–û—à–∏–±–∫–∞ VK Bridge: ' + e.message);
                }
            } else {
                debugLog('VK Bridge –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }

        // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            debugLog('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            try {
                loadProgress();
                updateMainScreen();
                debugLog('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!');
                
                // –°–∫—Ä—ã–≤–∞–µ–º debug —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    const debugDiv = document.getElementById('debug-info');
                    if (debugDiv) debugDiv.style.display = 'none';
                }, 5000);
                
            } catch (e) {
                debugLog('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
            }
        }

        // –ó–∞–ø—É—Å–∫
        debugLog('–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...');
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                debugLog('DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
                initVK();
                initApp();
            });
        } else {
            debugLog('DOM —É–∂–µ –≥–æ—Ç–æ–≤');
            initVK();
            initApp();
        }
    </script>
</body>
</html>